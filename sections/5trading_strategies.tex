\chapter{\textcolor{red}{Trading Strategies}}\label{ch:predictions}
The following chapter will give an overview over different trading strategies and compare their effectiveness with regards to trading with our ten stocks. %While this an interesting exercise in and of itself, these trading strategies also serve as a baseline to compare our prediction based trading strategy against.


\section{\textcolor{red}{Trading Strategies - Theoretical Background}}
#\subsection{\textcolor{red}{Idea and Process}}
%Many of the following strategies crucially depend on the time frame that is used. Some strategies are supposed to work over longer time frames like months and years, others over shorter ones like days or weeks. In this sense, the time frame of a trading strategy is a hyperparameter to be optimized. We decided to use a fixed time frame of one day for all strategies. On the one hand, this allows for direct comparisons and reduces the risk of overfitting. On the other hand, it was simply not feasible for us to do this hyperparameter optimization for every strategy. 

\subsection{\textcolor{red}{Mean Reversion and Momentum Trading}}
A vast body of scientific literature has tried to develop models that allow to understand and explain movements in stock markets. An even vaster community of traders has tried to implement these theories to do actual forecasting. While many of the theories are much more complex, two basic ideas can be summarized as "Momentum Based Trading" and "Mean Reversion Based Trading". The former theory hypothesizes that stocks that do well now will likely continue to do so in the future. The latter states that especially good or past performances are an exception and that stocks will eventually return to their average performance. A third strategy, Pairs Trading, will be detailed later. 

\subsubsection{\textcolor{red}{Mean-Reversion Trading}}
In 1985 Bondt and Thaler \citet{bondt_does_1985} were one of the early scholars to analyze mean reversion behaviour when they examined the hypothesis that markets tend to overreact. They looked at monthly returns of assets listed on the New York Stock Exchange in between 1926 and 1982 and constructed portfolios  of winners and losers that were updated every three years. Winners (losers) were those stocks that had performed the best (worst) over the previous years. Their idea was that "if stock prices systematically overshoot, then their reversal should be predictable from past return data alone, with no use of any accounting data such as earnings. [...] Extreme movements in stock prices will be followed by subsequent price movements in the opposite direction" (\cite{bondt_does_1985}). Indeed they observed that the portfolio of losers outperformed the market significantly. While they focus on a very long time horizon of three years, \citep{jegadeesh_returns_1993} summarizes that this behaviour could also be observed in the shorter term: "[...] contrarian strategies that select stocks based on their returns in the previous week or month generate significant abnormal returns." Note that in their analysis, Bondt and Thaler assumed that the mean-reversion behaviour was due to the market overreacting, i.e. a market inefficiency. One can also look at mean-reversion from another angle: Economic theories like the famous model from Fama and French describe the return of the stocks of a company as the result of market properties like the baseline market return rate and inherent properties of that company, like for example its book-to-market-ratio  (see \citep{fama_cross-section_1992} and \citep{fama_common_1993}). If such a relationship exists than this in turn implies that the actual observed stock movements should be random fluctuations around some much more slowly changing true return rate. However, it is unclear whether this mean reversion should happen in the form of a pendulum that swings forth and back (implying some short-term predictability) or more in the form of coin tosses reverting to their equilibrium by flooding past observations with new random ones (implying short-term non-predictability). 

\subsubsection{\textcolor{red}{Momentum Trading}}
On the opposite side of the spectrum of trading strategies lies the idea of momentum. \citep{jegadeesh_returns_1993} were one of the first to describe "that strategies which buy stocks that have performed well in the past and sell stocks that have performed poorly in the past generate significant positive returns over 3- to 12-month holding periods."   Interestingly, for the same portfolios they also saw mean-reverting behavior over the longer time frame of 12 to 48 months. Indeed, many scholars agree that mean reversion and momentum behaviour are not necessarily contradictions, but that the time frame determines in which way a stock will behave (see \citep{balvers_momentum_2006}). 


\subsection{\textcolor{red}{Pairs Trading}}
A third strategy we have examined is called pairs trading. The idea is to trade on the fact that some stocks usually move together. CocaCola and Pepsi for example sell a similar product and therefore should be affected similarly by events in the market. Assuming that the price difference between the two stocks should be somewhat constant, one can construct a trading strategy that profits if the spread randomly diverges too much and then converges again. While there are many ways to do to identify assets that move together (for an overview see e.g. \cite{gatev_pairs_1999}, \cite{ganapathy_vidyamurthy_pairs_2004}, \cite{do_new_2006}) we rely on the idea of cointegration (introduced \cite{engle_co-integration_1987}) to find suitable stocks. 

\subsubsection{\textcolor{red}{Cointegration}}
Cointegration means the following: If two time series $x_t, y_t$ are both integrated of order $d$ (i.e. they are stationary after applying d-th differences), then $x_t, y_t$ are cointegrated if there exists a linear combination $a x_t + b y_t$ that is integrated of order $d' < d$. Our stock prices (the log stock prices, to be more precise) are integrated of order one. One can therefore look for a time series  $y_t - \beta x_t = u_t$ and check whether $u_t$ is stationary. This leads to the two-step procedure developed by \cite{engle_co-integration_1987}, where in the first step $\beta$ is determined by least squares and in the second step $u_t$ is tested for stationarity using the Augmented Dickey-Fuller test (ADF)\footnotetext{The Philipps-Ouiliaris integration test (\citep{phillips_asymptotic_1990}) may be slightly more appropriate, but we stick with the formerly described cointegration test, as it can be easily implemented in python}. 

\section{\textcolor{red}{Trading Strategies - Implementation}}
As explained, the success of a trading strategy may depend on the time frame over which it is applied. In this sense, the time frame is a hyperparameter to be optimized. However, in the following we will use a fixed time frame of one day for all strategies. On the one hand, this allows for direct comparisons and reduces the risk of overfitting. On the other hand, it was simply not feasible for us to do this hyperparameter optimization for every strategy. 

\subsection{\textcolor{yellow}{Mean Reversion Portfolio}}
We replicate the basic idea from Bondt and Thaler \citet{bondt_does_1985} and use the following trading algorithm: 

\vspace{2ex}
\textbf{\small{Algorithm 1 - Mean-Reversion Portfolio}}
\vspace{-1ex}
%\begin{Verbatim}[frame=single]
\begin{verbatim}
for day in all_days: 
    rank portfolio along their returns from the last day
    Buy the two worst performers
    sell (short) the two best performers
\end{verbatim}
%\end{Verbatim}

While they found excessive returns of that strategy from 1932 to 1977 the results shown in figure \ref{fig:mean reversion} cannot beat a simple buy-and-hold strategy. This may be due to the wrong time frame used, or to the fact that if the strategy had indeed once been profitable we would assume enough market participants to trade on it as to render it practically useless. 

%Interestingly, reverting the algorithm to buy the best performers and short the worst performers to produce a portfolio-based momentum strategy also does not work. 

\begin{figure}[h!]
    \centering
    \begin{adjustbox}{width=.95\textwidth,center}
        \input{figures/mean_reversion_portfolio_performance.pgf}
    \end{adjustbox}  
    \caption{Performance of the mean-reversion portfolio (orange) against the returns of a portfolio that had once been bought in the beginning and kept unchanged throughout (buy-and-hold, blue).}
    \label{fig:mean reversion}
\end{figure}{}

\subsection{\textcolor{red}{Mean Reversion - single stocks}}
For single stocks, we have tried two different ways to implement a mean reversion strategy. The first strategy looks at whether the current stock price is above or below its past mean. The second one in spirit does the same thing, but with log-returns. 

\subsubsection{Mean Reversion - Stock Prices}
The idea behind this strategy is that there is a true fundamental value underlying the stock that is represented by the mean of past stock prices. The trading strategy looks like this: 

\vspace{2ex}
\textbf{\small{Algorithm 2: Mean-Reversion - Cumulative Mean}}
\vspace{-1ex}
\begin{verbatim}
for day in all_days: 
    cumulative_mean = cumulative mean of stock values until now
    if value of stock today > cumulative_mean:
        sell (short) the stock
    if value of stock today < cumulative_mean:
        buy the stock
\end{verbatim}

One obvious problem with this strategy is that any trend in the time series will be very poorly captured. Figure \ref{fig:mean_reversion_cum_mean} illustrates this by showing the time series plotted against their cumulative means (on the left) and the returns generated by trading on this strategy (on the right). 
\begin{figure}[h!]
    \centering
    \figuretitle{Mean Reversion for Single Stocks}
    \begin{minipage}[b]{0.49\textwidth}
        \centering
            \begin{adjustbox}{width=\textwidth,center, scale={1}{0.9}}
                \input{figures/all_stock_price_cum_mean.pgf}
            \end{adjustbox}
        %\caption{Flower one.}
    \end{minipage}
    \hfill
    \begin{minipage}[b]{0.49\textwidth}
        \centering
        \begin{adjustbox}{width=\textwidth,center, scale={1}{1.2}}
            \input{figures/all_returns_cum_mean_strategy.pgf}
        \end{adjustbox}
        %\caption{Flower two.}
    \end{minipage}
    \caption{On the left the original time series are plotted against their cumulative average. On the right we see the returns from a simple buy-and-hold strategy (pale) against the returns from the trading strategy.}
    \label{fig:mean_reversion_cum_mean}
\end{figure}{}

One can try to alleviate this problem by not using the current value against the cumulative mean, but instead for example 30d and 60d averages. The strategy then looks like this: 

\vspace{2ex}
\textbf{\small{Algorithm 3: Mean-Reversion Moving Averages}}
\vspace{-1ex}
\begin{verbatim}
for day in all_days: 
    60d_mean = mean of stock values of the past 90 days
    30d_mean = mean of stock values of the past 30 days
    if 30d_mean > 60d_mean:
        sell (short) the stock
    if 30d_mean < 60d_mean:
        buy the stock
\end{verbatim}

Figure \ref{fig:30d_60d_plot} shows the 30d and 60d moving averages as well as the original time series on the left hand and the returns from the trading strategy on the right hand. While the plots on the left do look much better, the trading strategy is still not able to yield useful results. 

\begin{figure}[h!]
    \centering
    \figuretitle{Mean Reversion with 30d and 60d Moving Averages}
    \begin{minipage}[b]{0.49\textwidth}
        \centering
            \begin{adjustbox}{width=\textwidth,center}
               \input{figures/all_stock_30d_60d.pgf}
            \end{adjustbox}
        %\caption{Flower one.}
    \end{minipage}
    \hfill
    \begin{minipage}[b]{0.49\textwidth}
        \centering
        \begin{adjustbox}{width=\textwidth,center, scale={1}{1.2}}
            \input{figures/all_60d_30d_strategy.pgf}
        \end{adjustbox}
        %\caption{Flower two.}
    \end{minipage}
    \caption{The left side shows the original timeline (pale), 60d moving averages (blue) and 30d moving averages (orange). The right side shows the returns generated by the strategy together with the returns from a simple buy-and-hold strategy (pale).}
    \label{fig:30d_60d_plot}
\end{figure}{}

\subsubsection{Mean Reversion - Log-Returns}
The second strategy looks at whether the current return is lower or higher than the cumulative mean of the time series. The algorithm just replaces the value of the stock in algorithm 2 with log-returns and the cumulative mean with the cumulative mean of log-returns. One can of course also easily replace the cumulative mean by e.g. the mean of the past 90, 60, or 30 days. The result for the cumulative mean is shown in figure \ref{fig:mean_reversion_returns}. Again our strategy is not able to perform better than a simple buy-and-hold strategy. 

\begin{figure}[h!]
    \centering
    \figuretitle{Mean-Reversion Strategy with Log-Returns of Single Stocks}
    \begin{adjustbox}{width=.95\textwidth,center}
        \input{figures/all_returns_cum_mean_returns_strategy.pgf}
    \end{adjustbox}  
    \caption{Mean Reversion based on past returns of single stocks. The returns achieved by the strategy are in bold color, while the return of a simple buy-and-hold strategy, (i.e. the return from a single share bought on the first day) is shown in pale}
    \label{fig:mean_reversion_returns}
\end{figure}{}

\subsection{Momentum Based Trading}
Momentum based trading is essentially the reverse of mean-reversion trading (albeit time horizons are usually chosen differently). Our trading strategies stick with the time frame of 1 day and work analogous to algorithms 1 and 3, but only use log-returns and reverse buy and sell. Results are shown in figure \ref{fig:momentum-trading} and are even less convincing than the results for mean-reversion trading. 

\begin{figure}[h!]
    \centering
    \begin{adjustbox}{width=.95\textwidth,center}
        \input{figures/momentum_portfolio_performance.pgf}
    \end{adjustbox}  
    \figuretitle{Momentum-Trading Log-Returns and 30d average}
    \begin{adjustbox}{width=.95\textwidth,center}
        \input{figures/momentum_30d_strategy.pgf}
    \end{adjustbox}      
    \caption{Momentum-Trading for portfolio (top) and for log-returns of single stocks (bottom). The returns achieved by the strategy are in bold color, while the return of a simple buy-and-hold strategy, (i.e. the return from a single share bought on the first day) is shown in pale}
    \label{fig:momentum-trading}
\end{figure}{}


\subsection{\textcolor{red}{Pairs Trading}}
Some authors (SOURCE) suggest trading on pairs of stocks. The idea is to find stocks that are cointegrated, i.e. that move together. One could for example assume that CocaCola and Pepsi sell a similar product and therefore should be affected similarly by events in the market. Assuming that the price difference between the two stocks should be somewhat constant, one can implement a strategy that buys one asset and shorts the other whenever the difference in price converges, and does the opposite when the difference diverges. The algorithm looks as follows: 
\vspace{2ex}
\textbf{\small{Algorithm 4 - Pairs Trading}}
\vspace{-1ex}
%\begin{Verbatim}[frame=single]
\begin{verbatim}
for i in range((1509 - 1)): # no predictions for last day
    if zscores[i] > 0:
        signal_pairs_trading.loc[i + 1, 'PG'] = -1
        signal_pairs_trading.loc[i + 1, 'JNJ'] = 1
        #money += val['diff'][i]
        #count -= 1
    # Buy long if the z-score is < 1
    elif zscores[i] < 0:
        signal_pairs_trading.loc[i + 1, 'PG'] = 1
        signal_pairs_trading.loc[i + 1, 'JNJ'] = -1
\end{verbatim}
%\end{Verbatim}

To identify cointegrated series, one can either rely on theoretical considerations (like the similarity between Cola and Pepsi) or one can try to run formal cointegration tests [ERKLÃ„RNUG, QUELLE]. As we only had ten stocks to choose from, we did the latter. We therefore tested all pairwise combinations of the ten stocks for cointegration. From a statistics point of view, this is of course bad practice insofar as one runs into a multiple comparison problem. We nevertheless wanted to see how it turns out. From all tests, the following pairs had a p-value smaller than 0.05: 

0.028312433093068277 JNJ PG
0.0149658441809201 PG JNJ
0.044162562247794815 VZ MMM
0.02095132057684397 VZ JNJ
0.039943528773524355 VZ V

We went for PG and JNJ, as the p-values were smallest and the cointegration worked in both directions. Also from a theory point of view, Procter\&Gamble and Johnson\&Johnson are indeed the most similar firms. The left of figure \ref{fig:coint_PG_JNJ} shows the two time series. Even though the cointegration test was significant, we see that the two stocks slowly diverge in value. The right side of the figure shows the performance of the trading strategy on the sample. We can see that pairs trading, at least in the way we implemented it, did not work out. 

\begin{figure}[h!]
    \centering
    \figuretitle{Mean-Reversion Strategy with Log-Returns of Single Stocks}
    \begin{adjustbox}{width=.95\textwidth,center}
        %\includegraphics[width = \linewidth]{figures/coint_PG_JNJ_plot.pdf}
        \input{figures/coint_PG_JNJ_plot.pgf}
        %\includegraphics[width = \linewidth]{figures/coint_PG_JNJ_plot.pdf}
        \input{figures/coint_PG_JNJ_returns.pgf}
    \end{adjustbox}  
    \caption{On the left the stock prices of PG and JNJ are plotted over time. On the right the profits from applying a pairs trading strategy are shown.}
    \label{fig:coint_PG_JNJ}
\end{figure}{}

\section{Trading Strategies Based on Our Predictions}
We have two sources of predictions: the machine learning things and the time series. 

As we have already established in chapter \ref{ch:ts} that none of our models was able to consistently beat a buy-and-hold strategy (equivalent to always predicting a positive return) we decided that using those for predictions is altogether futile. 




